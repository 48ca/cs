(function(){var e;window.editor=void 0,e=!1,this.runCode=function(){var e,t;return e=new FormData,e.append("language",$("#language").val()),e.append("pid",$("#pid").val()),e.append("program",window.editor.getValue()),t="#upload_form input, #upload_form select",$(t).attr("disabled","disabled"),$.ajax({type:"POST",url:"/api/programming/run_code",dataType:"json",data:e,processData:!1,contentType:!1}).done(function(e){var a;return a=1===e.success?"success":"warning",display_message("#upload_msg",a,e.message,function(){return 1===e.success?($(t).removeAttr("disabled"),fetch_submissions()):void 0}),1!==e.success?$(t).removeAttr("disabled"):void 0})},this.handle_upload=function(e){var t,a,n;return e.preventDefault(),t=new FormData,a=document.getElementById("file").files[0],a&&a.name&&t.append("file",a,a.name),t.append("language",$("#language").val()),t.append("pid",$("#pid").val()),n="#upload_form input, #upload_form select",$(n).attr("disabled","disabled"),$.ajax({type:"POST",url:"/api/programming/upload",dataType:"json",data:t,processData:!1,contentType:!1}).done(function(e){var t;return t=1===e.success?"success":"warning",display_message("#upload_msg",t,e.message,function(){return 1===e.success?($(n).removeAttr("disabled"),fetch_submissions()):void 0}),1!==e.success?$(n).removeAttr("disabled"):void 0})},this.viewLog=function(e){return api_call("GET","/api/programming/stdout",{token:e}).done(function(e){return 1===e.success?($("#stdoutModalLabel").html("Output for "+e.pid+" <small>"+new Date(1e3*e.timestamp).toISOString()+"</small>"),$("#stdoutModalBody").html("<pre>"+e.data+"</pre>"),$("#stdoutModal").modal({})):void 0})},this.fetch_problems=function(){return api_call("GET","/api/problem/get_unlocked",{}).done(function(e){var t,a,n,s,i,o,r,d,l;if(1===e.success){for(o=[],l=e.data,t=0,n=l.length;n>t;t++)d=l[t],d.programming===!0&&o.push({pid:d.pid,title:d.title});for(r="",a=0,s=o.length;s>a;a++)i=o[a],r+="<option value='"+i.pid+"'>"+i.title+"</option>";return $("#pid").html(r),$("#pid").selectpicker("refresh")}})},this.deleteRun=function(e){return confirm("Are you sure you want to remove this program? This action is irreversible.")?api_call("POST","/api/programming/delete_run",{p_token:e}).done(function(e){return 1===e.success?display_message("#rr"+token+" td","success",e.message,function(){return $("#r"+token).slideUp("fast")}):display_message("#rr"+token+" td","danger",e.message)}):void 0},this.fetch_submissions=function(){return api_call("GET","/api/programming/all",{}).done(function(e){var t,a,n,s,i,o;if(1===e.success){for(a="",t=e.data.length,i=e.data,n=0,s=i.length;s>n;n++)o=i[n],a+="<tr id='rr"+o.token+"'><td colspan='5'></div></tr>",a+="<tr id='r"+o.token+"'>",a+="<td><div class='dropdown'><a class='btn btn-default' id='optbtn"+o.token+'\' data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" data-target="#">'+t+"</a><ul class='dropdown-menu' aria-labelledby='optbtn"+o.token+"'><li><a href='javascript:void(0);' onclick='javascript:viewLog(\""+o.token+"\");'><i class='fa fa-eye fa-fw'></i> View Log</a></li><li><a href='javascript:void(0);' onclick='javascript:deleteRun(\""+o.token+"\");'><i class='fa fa-trash fa-fw'></i> Remove This Run</a></li></ul></div></td>",a+="<td>"+(o.timestamp?"<span class='timeago' title='"+new Date(1e3*o.timestamp).toISOString()+"'></span>":"<img src='/images/loading.gif' />")+"</td>",a+="<td>"+(o.pid?o.pid:"<img src='/images/loading.gif' />")+"</td>",a+="<td style='max-width:40vh;'>"+(o.message?o.message:"<img src='/images/loading.gif' />")+"</td>",a+="<td>"+(o.flag?"<span class='flag_hide'>"+o.flag+"</span>":"<span class='no_flag'></span>")+"</td>",a+="</tr>",t-=1;return $("#submissions_container").html(a),$(".flag_hide").each(function(){var e;return e=$(this).html(),e=e.replace("'","'"),$(this).html("<input type='password' class='form-control' value=\""+e+"\" onfocus=\"javascript:this.type='text';\" onblur=\"javascript:this.type='password';\" size='3' />")}),$(".no_flag").each(function(){return $(this).html("<input type='password' class='form-control' size='3' placeholder='No flag!' disabled />")}),$(".timeago").timeago(),0}})},this.loadCSS=function(e){var t;return t=document.createElement("link"),t.href=e,t.type="text/css",t.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(t)},$(function(){var t;return redirect_if_not_logged_in(!0),$("#upload_btn").on("click",handle_upload),fetch_problems(),t=setInterval(fetch_submissions,1e4),fetch_submissions(),window.editor=CodeMirror(document.getElementById("editor-container"),{mode:"python",theme:"eclipse",lineNumbers:!0}),$(document).keydown(function(t){17===t.keyCode&&(e=!0)}),$(document).keyup(function(t){13===t.keyCode&&e&&window.editor.getValue().trim().length>0?runCode():17===t.keyCode&&(e=!1)}),$("#theme").on("change",function(e){var t;return t=e.target.value,window.editor.setOption("theme",t)})})}).call(this);